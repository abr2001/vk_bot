class AddAccounts < ActiveRecord::Migration[5.1]
  def change
    tokens = [
      %w[81.176.239.101 401c829a340222ee9a9113e9535cfd7a46a6c0bdd800f58d18743965fa3a69bc5ac333d2d600efbf63da3],
      %w[195.158.225.17 fa540f22d4be32ef6096a99b6b7cf2cddcb7f9f4c7dc13645059047dc6d79d2aebf9f4462ddff3ec739df],
      %w[92.63.195.172  d1ca8b7ab8ef3c796c74f0f89179c02a05b92b2270cdc007e91a3e1593b2a2176d66ad89aec2654eeaca1],
      %w[85.143.170.54  30dd6fece5cae529476bb355a4e8c1a29bf904c9402f8c5437c4c2721343154a777af791ace022c8e11f2],
      %w[46.16.13.192 797fd53c4079bfb236a44ba62d3579e6ff67f51217f9c382d68bce33f6c62668f3c04e850512b6365dff6],
      %w[85.143.170.79  a6acaf8fb07c9634827293ffa762ffb15864ebdc36a8ed79ca082355e1eb7a704393462dee4774fcfdb24],
      %w[185.191.142.46 6d0b2e6d1cec63048a4b72925eae894e71b998f8d1bb174103608aa859f1e85fabd17a77d623f2aebe5c2],
      %w[77.220.205.166 2811b57c392a586880210defe5fa686503156c2bfbb20b17584484b51c67a8da3a5ed5a54e8c2de97f014],
      %w[81.176.239.234 0a3ab35ec326045c028583c8a61b9a9639859c4c242f2631ec894ff62c784bf5a2f3374902870d5a84a88],
      %w[81.176.239.219 b1b73e1a1cb47bdea460af3fd9f1670afb9ebda105047edda65e31c3c23e0b52b321612c740a9985f4bae],
      %w[91.107.119.13  bc7e0e5d5d350119a57ee861f4f9d177e6e5f8911b67512a00063e8c9b074af3039de71a62d3b16b3e913],
      %w[217.106.239.113  8b4acda3fff539975c256e8ed929fe918865878a00543d2b5a6466410469c001d0897f59e831eeb7032ce],
      %w[81.177.157.238 e4496db63e7606f657974f13901c5605f3b07e6ceeaec15e6ea3d982616995e6e36d5c39841fbf0be9623],
      %w[81.177.157.201 b4a71ccd77911f6cfdf18c1d08686eb175c0ece878712f184fe039d4c33390afe87cf140ad4e13acf05d0],
      %w[185.155.233.188  d734a6a421e87e63bb0ece89ffddec91b526f21470294c6ef0ebf7d16fac09fe358c1f5055f1baf66174f],
      %w[185.155.234.82 2d3b153bdb29cae935f7e4e8163fb9dd9550fda6a4a84aad39299d9c679522d2b699617e72111600311f5],
      %w[195.190.12.249 684f758b6f286f1235b5c1fd23284b3b31745c02204703bd8613b21d2086c0b3d27da3a7f24a25dae4e76],
      %w[85.143.189.2 e71e7392be614328c0fcbaa436bb8ea5c16e60de2007041a6ef8b29b2914c62a6d8aaf6f3c5db40c5ef78],
      %w[85.143.189.2 7416bd5490e2190809031e598889bfc40ffe80d20ff805dc8346f1dcab6e710efe415e358ff01545c7ea3],
      %w[185.184.78.4 b5592420953b610f32158b0a2e6d0d38f704dcabc97601a1518eb7dfb59dfd5fc18a8fef6dd29c500276a]
    ]

    user = User.find(1)

    tokens.each do |token|
      account_params = { proxy_ip: token[0], proxy_port: 4045, token: token[1] }
      account = user.accounts.new(account_params)
      begin
        response = Vkontakte::FriendsService.new(account: account).users_get
        sleep 2
        account.code = response[:response].response.first.id
        account.save
      rescue Exception => e
        puts e
      end
    end
  end
end
